@preview
Feature: Preview article with video, audio and image in slideshows

  Scenario: Preview article with video, audio and image in slideshows
    Given I am authenticated as "test.user"
    When I add "Content-Type" header equal to "application/json"
    And I send a "POST" request to "/api/v1/content/routes/" with body:
     """
      {
        "route": {
          "name": "Simple test route",
          "slug": "simple-test-route",
          "type": "collection",
          "articlesTemplateName": "article_with_slideshow.html.twig"
        }
      }
    """
    Then the response status code should be 201
    And I am authenticated as "test.user"
    When I add "Content-Type" header equal to "application/json"
    And I send a "POST" request to "/api/{version}/preview/package/generate_token/7" with body:
    """
    {
      "pubstatus":"usable",
      "authors":[
        {
          "biography":"",
          "name":"Admin Person",
          "role":""
        }
      ],
      "annotations":[

      ],
      "guid":"urn:newsml:sddev-api.superdesk.pro:2018-11-07T14:04:55.737045:4ee44206-6c8c-4192-b590-50aa8a69cdb2",
      "headline":"testing video audio",
      "copyrightnotice":"",
      "priority":5,
      "version":"6",
      "readtime":0,
      "slugline":"testing video audio",
      "description_text":"testingvideoaudio",
      "extra_items":{
        "gallery":{
          "items":[
            {
              "pubstatus":"usable",
              "genre":[
                {
                  "name":"Article (news)",
                  "code":"Article"
                }
              ],
              "versioncreated":"2018-11-07T13:09:36+0000",
              "urgency":3,
              "body_text":"video",
              "guid":"tag:sddev-api.superdesk.pro:2018:c2f6af0e-41cf-4a2b-a870-8c51a9c628f1",
              "headline":"video",
              "renditions":{
                "original":{
                  "mimetype":"video/mp4",
                  "href":"https://amazonaws.com/2018110714118/b42edf4c501057a44499c8148d60a6343fb0e968150fc538404b5b72ed9279b9.mp4",
                  "media":"2018110714118/b42edf4c501057a44499c8148d60a6343fb0e968150fc538404b5b72ed9279b9.mp4"
                }
              },
              "usageterms":"",
              "firstcreated":"2018-11-07T13:09:34+0000",
              "copyrightnotice":"",
              "priority":6,
              "type":"video",
              "language":"en",
              "source":"",
              "description_text":"video",
              "copyrightholder":"",
              "mimetype":"video/mp4",
              "version":"2"
            },
            {
              "pubstatus":"usable",
              "genre":[
                {
                  "name":"Article (news)",
                  "code":"Article"
                }
              ],
              "versioncreated":"2018-11-07T13:09:36+0000",
              "urgency":3,
              "body_text":"audio",
              "guid":"tag:sddev-api.superdesk.pro:2018:b5f0c79e-f77b-405b-8ef7-a2ed0361f911",
              "headline":"audio",
              "renditions":{
                "original":{
                  "mimetype":"audio/mp3",
                  "href":"https://amazonaws.com/2018110714118/68e1b49e00fe67fc25f0e20ad013731140707f22d43feae11f9bac2e458e0355.mp3",
                  "media":"2018110714118/68e1b49e00fe67fc25f0e20ad013731140707f22d43feae11f9bac2e458e0355.mp3"
                }
              },
              "usageterms":"",
              "firstcreated":"2018-11-07T13:09:34+0000",
              "copyrightnotice":"",
              "priority":6,
              "type":"audio",
              "language":"en",
              "source":"",
              "description_text":"audio",
              "copyrightholder":"",
              "mimetype":"audio/mp3",
              "version":"2"
            },
            {
              "pubstatus":"usable",
              "genre":[
                {
                  "name":"Article (news)",
                  "code":"Article"
                }
              ],
              "versioncreated":"2018-11-07T13:09:36+0000",
              "urgency":3,
              "body_text":"image2",
              "guid":"tag:sddev-api.superdesk.pro:2018:052957f9-1a87-4e04-a6e4-a47c862ce65f",
              "headline":"image2",
              "renditions":{
                "thumbnail":{
                  "width":84,
                  "height":120,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/d5bc35b760110f72da613b9bfd8a664e4f13546b0143a051cc86ed112229c8ef.jpg",
                  "href":"https://amazonaws.com/2018110714118/d5bc35b760110f72da613b9bfd8a664e4f13546b0143a051cc86ed112229c8ef.jpg",
                  "poi":{
                    "x":42,
                    "y":60
                  }
                },
                "baseImage":{
                  "width":989,
                  "height":1400,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/194c3256dee0fc9bf622e67b7bd29829177d1d60ff0dd1647427f5df880335a2.jpg",
                  "href":"https://amazonaws.com/2018110714118/194c3256dee0fc9bf622e67b7bd29829177d1d60ff0dd1647427f5df880335a2.jpg",
                  "poi":{
                    "x":494,
                    "y":700
                  }
                },
                "naslovnica":{
                  "width":265,
                  "height":375,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/e0a528f0-ceef-46ac-99d5-cbd38da8b980.jpg",
                  "href":"https://amazonaws.com/2018110714118/e0a528f0-ceef-46ac-99d5-cbd38da8b980.jpg",
                  "poi":{
                    "x":132,
                    "y":187
                  }
                },
                "ratio1_0-small":{
                  "width":200,
                  "height":200,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/c235c979-0fff-41b3-b516-c4bddc48bcc3.jpg",
                  "href":"https://amazonaws.com/2018110714118/c235c979-0fff-41b3-b516-c4bddc48bcc3.jpg",
                  "poi":{
                    "x":132,
                    "y":131
                  }
                },
                "original":{
                  "width":265,
                  "height":375,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/a875fce7c0fb962644f7ad3972d54fffdf001b4429501873143d5380f604f7ea.jpg",
                  "href":"https://amazonaws.com/2018110714118/a875fce7c0fb962644f7ad3972d54fffdf001b4429501873143d5380f604f7ea.jpg",
                  "poi":{
                    "x":132,
                    "y":187
                  }
                },
                "viewImage":{
                  "width":452,
                  "height":640,
                  "mimetype":"image/jpeg",
                  "media":"2018110714118/ba546ff279e0735550f3bfa11ae4915c96395030fa64467a03f7797375bc9915.jpg",
                  "href":"https://amazonaws.com/2018110714118/ba546ff279e0735550f3bfa11ae4915c96395030fa64467a03f7797375bc9915.jpg",
                  "poi":{
                    "x":226,
                    "y":320
                  }
                }
              },
              "usageterms":"",
              "firstcreated":"2018-11-07T13:09:34+0000",
              "copyrightnotice":"",
              "priority":6,
              "type":"picture",
              "language":"en",
              "source":"",
              "description_text":"image2",
              "copyrightholder":"",
              "mimetype":"image/jpeg",
              "version":"2"
            }
          ]
        }
      },
      "description_html":"<p><b>testing</b> <b>video</b> <b>audio</b></p>",
      "service":[
        {
          "name":"BBC",
          "code":"bbc"
        }
      ],
      "versioncreated":"2018-11-07T13:10:05+0000",
      "usageterms":"",
      "firstcreated":"2018-11-07T13:04:55+0000",
      "associations":{
        "gallery--3":{
          "pubstatus":"usable",
          "genre":[
            {
              "name":"Article (news)",
              "code":"Article"
            }
          ],
          "versioncreated":"2018-11-07T13:09:36+0000",
          "urgency":3,
          "body_text":"image2",
          "guid":"tag:sddev-api.superdesk.pro:2018:052957f9-1a87-4e04-a6e4-a47c862ce65f",
          "headline":"image2",
          "renditions":{
            "thumbnail":{
              "width":84,
              "height":120,
              "mimetype":"image/jpeg",
              "media":"2018110714118/d5bc35b760110f72da613b9bfd8a664e4f13546b0143a051cc86ed112229c8ef.jpg",
              "href":"https://amazonaws.com/2018110714118/d5bc35b760110f72da613b9bfd8a664e4f13546b0143a051cc86ed112229c8ef.jpg",
              "poi":{
                "x":42,
                "y":60
              }
            },
            "baseImage":{
              "width":989,
              "height":1400,
              "mimetype":"image/jpeg",
              "media":"2018110714118/194c3256dee0fc9bf622e67b7bd29829177d1d60ff0dd1647427f5df880335a2.jpg",
              "href":"https://amazonaws.com/2018110714118/194c3256dee0fc9bf622e67b7bd29829177d1d60ff0dd1647427f5df880335a2.jpg",
              "poi":{
                "x":494,
                "y":700
              }
            },
            "naslovnica":{
              "width":265,
              "height":375,
              "mimetype":"image/jpeg",
              "media":"2018110714118/e0a528f0-ceef-46ac-99d5-cbd38da8b980.jpg",
              "href":"https://amazonaws.com/2018110714118/e0a528f0-ceef-46ac-99d5-cbd38da8b980.jpg",
              "poi":{
                "x":132,
                "y":187
              }
            },
            "ratio1_0-small":{
              "width":200,
              "height":200,
              "mimetype":"image/jpeg",
              "media":"2018110714118/c235c979-0fff-41b3-b516-c4bddc48bcc3.jpg",
              "href":"https://amazonaws.com/2018110714118/c235c979-0fff-41b3-b516-c4bddc48bcc3.jpg",
              "poi":{
                "x":132,
                "y":131
              }
            },
            "original":{
              "width":265,
              "height":375,
              "mimetype":"image/jpeg",
              "media":"2018110714118/a875fce7c0fb962644f7ad3972d54fffdf001b4429501873143d5380f604f7ea.jpg",
              "href":"https://amazonaws.com/2018110714118/a875fce7c0fb962644f7ad3972d54fffdf001b4429501873143d5380f604f7ea.jpg",
              "poi":{
                "x":132,
                "y":187
              }
            },
            "viewImage":{
              "width":452,
              "height":640,
              "mimetype":"image/jpeg",
              "media":"2018110714118/ba546ff279e0735550f3bfa11ae4915c96395030fa64467a03f7797375bc9915.jpg",
              "href":"https://amazonaws.com/2018110714118/ba546ff279e0735550f3bfa11ae4915c96395030fa64467a03f7797375bc9915.jpg",
              "poi":{
                "x":226,
                "y":320
              }
            }
          },
          "usageterms":"",
          "firstcreated":"2018-11-07T13:09:34+0000",
          "copyrightnotice":"",
          "priority":6,
          "type":"picture",
          "language":"en",
          "source":"",
          "description_text":"image2",
          "copyrightholder":"",
          "mimetype":"image/jpeg",
          "version":"2"
        },
        "gallery--1":{
          "pubstatus":"usable",
          "genre":[
            {
              "name":"Article (news)",
              "code":"Article"
            }
          ],
          "versioncreated":"2018-11-07T13:09:36+0000",
          "urgency":3,
          "body_text":"video",
          "guid":"tag:sddev-api.superdesk.pro:2018:c2f6af0e-41cf-4a2b-a870-8c51a9c628f1",
          "headline":"video",
          "renditions":{
            "original":{
              "mimetype":"video/mp4",
              "href":"https://amazonaws.com/2018110714118/b42edf4c501057a44499c8148d60a6343fb0e968150fc538404b5b72ed9279b9.mp4",
              "media":"2018110714118/b42edf4c501057a44499c8148d60a6343fb0e968150fc538404b5b72ed9279b9.mp4"
            }
          },
          "usageterms":"",
          "firstcreated":"2018-11-07T13:09:34+0000",
          "copyrightnotice":"",
          "priority":6,
          "type":"video",
          "language":"en",
          "source":"",
          "description_text":"video",
          "copyrightholder":"",
          "mimetype":"video/mp4",
          "version":"2"
        },
        "featuremedia":{
          "pubstatus":"usable",
          "genre":[
            {
              "name":"Article (news)",
              "code":"Article"
            }
          ],
          "versioncreated":"2018-11-07T13:05:22+0000",
          "urgency":3,
          "body_text":"image1",
          "guid":"tag:sddev-api.superdesk.pro:2018:a431655e-17d0-41eb-8bb3-75bae9c8b36a",
          "headline":"image1",
          "renditions":{
            "original":{
              "width":1600,
              "height":1067,
              "mimetype":"image/jpeg",
              "media":"2018110714114/3ef147eeee86b65fb6385a24ec936541e8d17e6b2421d29b9d26d2ce01be15c0.jpg",
              "href":"https://amazonaws.com/2018110714114/3ef147eeee86b65fb6385a24ec936541e8d17e6b2421d29b9d26d2ce01be15c0.jpg",
              "poi":{
                "x":800,
                "y":533
              }
            },
            "ratio1_6-big":{
              "width":872,
              "height":545,
              "mimetype":"image/jpeg",
              "media":"2018110714114/0a613dff-e532-4cbc-bfb1-9645deb6be68.jpg",
              "href":"https://amazonaws.com/2018110714114/0a613dff-e532-4cbc-bfb1-9645deb6be68.jpg",
              "poi":{
                "x":800,
                "y":503
              }
            },
            "ratio1_7":{
              "width":780,
              "height":460,
              "mimetype":"image/jpeg",
              "media":"2018110714114/0c8578fe-e504-4a02-865b-db501c977f4b.jpg",
              "href":"https://amazonaws.com/2018110714114/0c8578fe-e504-4a02-865b-db501c977f4b.jpg",
              "poi":{
                "x":800,
                "y":472
              }
            },
            "ratio1_0-small":{
              "width":200,
              "height":200,
              "mimetype":"image/jpeg",
              "media":"2018110714114/2ea5281b-9d5a-4e34-97ab-97bc5b9d05ed.jpg",
              "href":"https://amazonaws.com/2018110714114/2ea5281b-9d5a-4e34-97ab-97bc5b9d05ed.jpg",
              "poi":{
                "x":533,
                "y":533
              }
            },
            "ratio2_1":{
              "width":800,
              "height":385,
              "mimetype":"image/jpeg",
              "media":"2018110714114/c8f38a7a-1865-4d99-b018-3be0a0982796.jpg",
              "href":"https://amazonaws.com/2018110714114/c8f38a7a-1865-4d99-b018-3be0a0982796.jpg",
              "poi":{
                "x":800,
                "y":388
              }
            },
            "naslovnica":{
              "width":265,
              "height":375,
              "mimetype":"image/jpeg",
              "media":"2018110714114/25d487e8-62ad-4ed7-9ff4-918565a32d21.jpg",
              "href":"https://amazonaws.com/2018110714114/25d487e8-62ad-4ed7-9ff4-918565a32d21.jpg",
              "poi":{
                "x":373,
                "y":533
              }
            },
            "ratio1_0-big":{
              "width":573,
              "height":573,
              "mimetype":"image/jpeg",
              "media":"2018110714114/e8d7c19d-96a1-4c6e-b883-c0af8692cb70.jpg",
              "href":"https://amazonaws.com/2018110714114/e8d7c19d-96a1-4c6e-b883-c0af8692cb70.jpg",
              "poi":{
                "x":533,
                "y":533
              }
            },
            "baseImage":{
              "width":1400,
              "height":933,
              "mimetype":"image/jpeg",
              "media":"2018110714114/1b2e059d26cc7f96cc5facc9731e2b0b6eea78412a9e0475590477f56f127135.jpg",
              "href":"https://amazonaws.com/2018110714114/1b2e059d26cc7f96cc5facc9731e2b0b6eea78412a9e0475590477f56f127135.jpg",
              "poi":{
                "x":700,
                "y":466
              }
            },
            "thumbnail":{
              "width":180,
              "height":120,
              "mimetype":"image/jpeg",
              "media":"2018110714114/02e12d07a541246105f896c6d693618389e631d3cdd86663f226e462a5de00c9.jpg",
              "href":"https://amazonaws.com/2018110714114/02e12d07a541246105f896c6d693618389e631d3cdd86663f226e462a5de00c9.jpg",
              "poi":{
                "x":90,
                "y":60
              }
            },
            "ratio2_1-big":{
              "width":1200,
              "height":571,
              "mimetype":"image/jpeg",
              "media":"2018110714114/7e265268-0472-4928-8fcd-f00e20591900.jpg",
              "href":"https://amazonaws.com/2018110714114/7e265268-0472-4928-8fcd-f00e20591900.jpg",
              "poi":{
                "x":800,
                "y":381
              }
            },
            "ratio1_6-small":{
              "width":376,
              "height":235,
              "mimetype":"image/jpeg",
              "media":"2018110714114/b3f0e555-d870-4c70-9720-12cc3cea7272.jpg",
              "href":"https://amazonaws.com/2018110714114/b3f0e555-d870-4c70-9720-12cc3cea7272.jpg",
              "poi":{
                "x":800,
                "y":503
              }
            },
            "viewImage":{
              "width":640,
              "height":426,
              "mimetype":"image/jpeg",
              "media":"2018110714114/d5e4c4978834d25233b88d732c7d2784e174f8734401a03bfe28c996edc47322.jpg",
              "href":"https://amazonaws.com/2018110714114/d5e4c4978834d25233b88d732c7d2784e174f8734401a03bfe28c996edc47322.jpg",
              "poi":{
                "x":320,
                "y":213
              }
            }
          },
          "usageterms":"",
          "firstcreated":"2018-11-07T13:05:20+0000",
          "copyrightnotice":"",
          "priority":6,
          "type":"picture",
          "language":"en",
          "source":"",
          "description_text":"image1",
          "copyrightholder":"",
          "mimetype":"image/jpeg",
          "version":"2"
        },
        "gallery--2":{
          "pubstatus":"usable",
          "genre":[
            {
              "name":"Article (news)",
              "code":"Article"
            }
          ],
          "versioncreated":"2018-11-07T13:09:36+0000",
          "urgency":3,
          "body_text":"audio",
          "guid":"tag:sddev-api.superdesk.pro:2018:b5f0c79e-f77b-405b-8ef7-a2ed0361f911",
          "headline":"audio",
          "renditions":{
            "original":{
              "mimetype":"audio/mp3",
              "href":"https://amazonaws.com/2018110714118/68e1b49e00fe67fc25f0e20ad013731140707f22d43feae11f9bac2e458e0355.mp3",
              "media":"2018110714118/68e1b49e00fe67fc25f0e20ad013731140707f22d43feae11f9bac2e458e0355.mp3"
            }
          },
          "usageterms":"",
          "firstcreated":"2018-11-07T13:09:34+0000",
          "copyrightnotice":"",
          "priority":6,
          "type":"audio",
          "language":"en",
          "source":"",
          "description_text":"audio",
          "copyrightholder":"",
          "mimetype":"audio/mp3",
          "version":"2"
        }
      },
      "type":"text",
      "language":"en",
      "source":"bbc",
      "wordcount":3,
      "charcount":17,
      "copyrightholder":"",
      "profile":"news",
      "body_html":"<p><b>testing</b> <b>video</b> <b>audio</b></p>"
    }
    """
    Then the response status code should be 200
    And the JSON should be equal to:
    """
    {
        "preview_url": "http:\/\/localhost\/preview\/publish\/package\/0123456789abc"
    }
    """
    When I go to "http://localhost/preview/publish/package/0123456789abc"
    Then the response status code should be 200
    And the response should contain "https://amazonaws.com/2018110714118/68e1b49e00fe67fc25f0e20ad013731140707f22d43feae11f9bac2e458e0355.mp3"
    And the response should contain "https://amazonaws.com/2018110714118/b42edf4c501057a44499c8148d60a6343fb0e968150fc538404b5b72ed9279b9.mp4"
    And the response should contain "https://amazonaws.com/2018110714118/a875fce7c0fb962644f7ad3972d54fffdf001b4429501873143d5380f604f7ea.jpg"